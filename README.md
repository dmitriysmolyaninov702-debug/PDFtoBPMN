# 🚀 BPMN Process Automation

> **Для полного понимания проекта начните с этого файла. Все документы связаны через навигацию ниже.**

## 📋 Описание проекта

Проект автоматизированной обработки текстов, таблиц и схем для построения схем бизнес-процессов в формате BPMN 2.0, совместимом с Camunda Modeler.

---

## 📚 Навигация по документации

```
                           ┌──────────────────┐
                           │   README.md      │ ⭐ НАЧНИТЕ ЗДЕСЬ
                           │  (Этот файл)     │
                           └────────┬─────────┘
                                    │
                 ┌──────────────────┼──────────────────┐
                 │                  │                  │
        ┌────────▼─────────┐ ┌─────▼──────┐ ┌────────▼────────┐
        │  docs/           │ │ .cursorrules│ │  Changelog.md   │
        │  Architecture.md │ │             │ │                 │
        │                  │ │ Методология │ │ История         │
        │  Техническая     │ │ работы      │ │ изменений       │
        │  архитектура     │ │ с процессами│ │                 │
        └──────────────────┘ └─────────────┘ └─────────────────┘
                 │
        ┌────────┴────────┐
        │                 │
    ┌───▼──────────────┐ ┌▼─────────────────┐
    │ docs/            │ │ DeepSeek-OCR/    │
    │ DeepSeek_OCR_    │ │ QUICK_START.md   │
    │ Setup.md         │ │                  │
    │                  │ │ Быстрая          │
    │ Полная установка │ │ шпаргалка        │
    └──────────────────┘ └──────────────────┘
```

### 🎯 Основные документы

| Документ | Описание | Для кого |
|----------|----------|----------|
| **[README.md](README.md)** | ⭐ **Этот файл** - главная точка входа | Все |
| **[docs/Architecture.md](docs/Architecture.md)** | Полная техническая архитектура модуля PDF to Context | Разработчики |
| **[docs/DeepSeek_OCR_Setup.md](docs/DeepSeek_OCR_Setup.md)** | Установка и настройка DeepSeek-OCR на WSL2 | DevOps, Установка |
| **[DeepSeek-OCR/QUICK_START.md](DeepSeek-OCR/QUICK_START.md)** | Быстрая шпаргалка для развертывания | Быстрый старт |
| **[Changelog.md](Changelog.md)** | История всех изменений проекта | Все |
| **[.cursorrules](.cursorrules)** | Правила для Cursor AI и методология работы | AI, Разработчики |

### 🔧 Для разработки

- **Архитектура PDF to Context**: [docs/Architecture.md](docs/Architecture.md)
  - Компоненты системы (Parser, Analyzer, Extractors, IR, Formatter)
  - Алгоритм обработки (структура → OCR → встраивание)
  - Модели данных (BBox, TextBlock, IRBlock, IR)
  - Примеры использования

- **Принципы разработки**: см. раздел [💻 Принципы разработки](#принципы-разработки) ниже
  - SOLID, KISS, DRY
  - Архитектурный подход с согласованием
  - Workflow разработки

### 🚀 Для установки и развертывания

- **Полная установка DeepSeek-OCR**: [docs/DeepSeek_OCR_Setup.md](docs/DeepSeek_OCR_Setup.md)
  - Требования к системе (GPU, CUDA, память)
  - Проверка окружения (WSL2, NVIDIA, Python)
  - Пошаговая установка (PyTorch, vLLM, flash-attention)
  - Настройка режимов (Tiny/Small/Base/Large/Gundam)
  - Troubleshooting и решение проблем
  - Синхронизация между компьютерами

- **Быстрый старт**: [DeepSeek-OCR/QUICK_START.md](DeepSeek-OCR/QUICK_START.md)
  - Команды установки одним блоком
  - Базовая конфигурация
  - Частые проблемы

### 📖 Для работы с процессами

- **Методология процессного моделирования**: [.cursorrules](.cursorrules) (раздел "МЕТОДОЛОГИЯ")
  - Этап 1: Анализ и структурирование
  - Этап 2: RACI матрица
  - Этап 3: Текстовый пайплайн
  - Этап 4: BPMN XML + MD документация

### 📝 История и изменения

- **Changelog**: [Changelog.md](Changelog.md)
  - Все изменения по датам
  - Обоснования архитектурных решений
  - Добавленные функции и исправления

---

## 💡 Быстрые ссылки для новых участников

**Хочу понять архитектуру?**  
→ [docs/Architecture.md](docs/Architecture.md)

**Хочу установить DeepSeek-OCR?**  
→ [docs/DeepSeek_OCR_Setup.md](docs/DeepSeek_OCR_Setup.md) (полная инструкция)  
→ [DeepSeek-OCR/QUICK_START.md](DeepSeek-OCR/QUICK_START.md) (быстрый старт)

**Хочу начать работу с процессами?**  
→ [.cursorrules](.cursorrules) (методология 4 этапов)

**Хочу узнать что изменилось?**  
→ [Changelog.md](Changelog.md)

---

## 🎯 Назначение

Автоматическое преобразование документации бизнес-процессов из различных форматов в визуальные BPMN диаграммы с полным описанием каждого элемента процесса.

## 📥 Входные форматы

Система поддерживает обработку следующих форматов документов:

- **PDF** - с поддержкой OCR для распознавания текста из отсканированных документов
- **TXT** - текстовые файлы
- **DOCX** - документы Microsoft Word
- **XLSX** - таблицы Microsoft Excel

## 📤 Выходные форматы

### BPMN XML (.bpmn)
- Полная совместимость с **Camunda Modeler**
- Стандарт BPMN 2.0
- Визуальное представление с координатами всех элементов
- Pool lanes с ролевой моделью
- Структурированные данные о процессах

### Markdown (.md)
Чек лист выполнения блоков activity в виде таблицы последовательности выполнения
- Наименование действия
- Ответственный за выполнение
- Ссылки на пункты регламентов

## 🏗️ Структура проекта

```
Obligations/
├── input/                                  # Исходные документы (READ-ONLY для AI)
│   ├── ДП-Б6.001-07.pdf
│   ├── ДП-М1.020-06.pdf
│   ├── КД-СТ-161-01.pdf
│   └── Руководство_по_качеству.pdf
│
├── output/                                 # Результаты обработки (WORKSPACE)
│   ├── ДП-Б6.001-07/                      # Папка создается автоматически
│   │   ├── ДП-Б6.001-07_OCR.md            # Расшифровка текста
│   │   ├── ДП-Б6.001-07_OCR.pdf           # PDF копия OCR
│   │   ├── ДП-Б6.001-07_RACI.md           # RACI матрица
│   │   ├── ДП-Б6.001-07_RACI.pdf          # PDF копия RACI
│   │   ├── ДП-Б6.001-07_Pipeline.md       # Текстовый пайплайн
│   │   ├── ДП-Б6.001-07_Pipeline.pdf      # PDF копия Pipeline
│   │   ├── ДП-Б6.001-07.bpmn              # BPMN диаграмма
│   │   ├── ДП-Б6.001-07.md                # Документация процесса
│   │   └── ДП-Б6.001-07.pdf               # PDF копия документации
│   │
│   └── ДП-М1.020-06/                      # Другой документ
│       └── ...
│
├── scripts/                                # Рабочий код проекта
│   └── pdf_to_context/                    # Основной модуль обработки
│       ├── pipeline.py                    # Главный пайплайн
│       ├── core/                          # Ядро системы
│       ├── extractors/                    # Извлечение данных
│       ├── ir/                            # Промежуточное представление
│       ├── models/                        # Модели данных
│       └── ocr_service/                   # OCR интеграция
│
├── archive/                                # Архив
│   ├── old_output/                        # Старые результаты
│   ├── old_docs/                          # Старая документация
│   └── tests/                             # Тестовые скрипты
│
├── DeepSeek-OCR/                          # Модуль DeepSeek OCR
│
├── docs/                                  # Документация проекта
│   ├── Architecture.md
│   └── DeepSeek_OCR_Setup.md
│
├── .cursorrules                           # Правила для Cursor AI
├── README.md                              # Этот файл
├── Changelog.md                           # История изменений
└── requirements.txt                       # Зависимости Python
```

### 🔗 Связь файлов для каждого процесса

Для каждого бизнес-процесса создается **набор из 9 связанных файлов**:

```
┌─────────────────────────────────────────────────────────────┐
│           ПРОЦЕСС: "ДП-М1.020-06"                           │
└─────────────────────────────────────────────────────────────┘
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
┌───────▼────────┐  ┌────────▼────────┐  ┌───────▼────────┐
│ Этап 2: RACI   │  │ Этап 3: Pipeline│  │ Этап 4: BPMN   │
│                │  │                 │  │                │
│ _RACI.md       │  │ _Pipeline.md    │  │ .bpmn + .md    │
│ _RACI.pdf      │  │ _Pipeline.pdf   │  │ .pdf           │
│                │  │                 │  │                │
│ • Матрица      │  │ • Детальное     │  │ • XML схема    │
│   ответстве-   │  │   описание      │  │ • Таблицы с    │
│   нности       │  │   каждого       │  │   описанием    │
│ • Роли R/A/C/I │  │   activity      │  │   элементов    │
│ • Pool & Lanes │  │ • Способы       │  │                │
│                │  │   передачи      │  │ Открывается в  │
│                │  │   данных        │  │ Camunda Modeler│
│                │  │ • Время         │  │                │
│                │  │ • Метрики       │  │                │
│                │  │                 │  │ + PDF копии    │
│                │  │ + PDF копия     │  │ для печати     │
└────────────────┘  └─────────────────┘  └────────────────┘
         │                    │                    │
         └────────────────────┴────────────────────┘
                              │
                       + Этап 1: OCR
                              │
                    ┌─────────▼─────────┐
                    │ _OCR.md + .pdf    │
                    │                   │
                    │ • Расшифровка     │
                    │   исходного PDF   │
                    │ • DeepSeek OCR    │
                    └───────────────────┘
```

**Пример для документа "ДП-М1.020-06.pdf":**

В папке `output/ДП-М1.020-06/`:
1. `ДП-М1.020-06_OCR.md` + `ДП-М1.020-06_OCR.pdf` - расшифровка
2. `ДП-М1.020-06_RACI.md` + `ДП-М1.020-06_RACI.pdf` - матрица ответственности
3. `ДП-М1.020-06_Pipeline.md` + `ДП-М1.020-06_Pipeline.pdf` - текстовый пайплайн
4. `ДП-М1.020-06.bpmn` - BPMN диаграмма (только XML)
5. `ДП-М1.020-06.md` + `ДП-М1.020-06.pdf` - документация процесса

---

## 🔄 Workflow обработки документа

### Команда пользователя
```bash
"обработай документ ДП-М1.020-06"
```

### Автоматическая последовательность

```
┌─────────────────────────────────────────────────┐
│ ШАГ 1: Проверка и подготовка                   │
│ • Найти PDF в input/                            │
│ • Создать папку output/ДП-М1.020-06/           │
└─────────────────┬───────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────┐
│ ШАГ 2: OCR обработка (DeepSeek)                │
│ • Запустить scripts/pdf_to_context/pipeline.py │
│ • Создать _OCR.md + _OCR.pdf                    │
└─────────────────┬───────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────┐
│ ШАГ 3: RACI матрица                             │
│ • Анализ OCR текста                             │
│ • Создать _RACI.md + _RACI.pdf                  │
│ • Согласование структуры ролей                  │
└─────────────────┬───────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────┐
│ ШАГ 4: Текстовый пайплайн                       │
│ • Детальное описание каждого activity           │
│ • Создать _Pipeline.md + _Pipeline.pdf          │
└─────────────────┬───────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────┐
│ ШАГ 5: BPMN и документация                      │
│ • Генерация BPMN XML                            │
│ • Создать .bpmn, .md, .pdf                      │
│ • Валидация в Camunda Modeler                   │
└─────────────────┬───────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────┐
│ ШАГ 6: Отчет                                    │
│ • Список созданных файлов                       │
│ • Статистика процесса                           │
│ • Выявленные проблемы                           │
│ • Рекомендации                                  │
└─────────────────────────────────────────────────┘
```

### Генерация PDF копий

Все MD файлы автоматически конвертируются в PDF с помощью `pandoc`:
- Поддержка русского языка (шрифт DejaVu Sans)
- Сохранение структуры таблиц
- Автоматическое оглавление
- Landscape ориентация для широких таблиц (RACI)

## 💻 Принципы разработки

### Архитектурный подход

Разработка ведется по принципам **SOLID**, **KISS**, **DRY**:

- **SOLID** - пять принципов объектно-ориентированного проектирования
  - Single Responsibility (единственная ответственность)
  - Open/Closed (открыт/закрыт)
  - Liskov Substitution (подстановка Барбары Лисков)
  - Interface Segregation (разделение интерфейса)
  - Dependency Inversion (инверсия зависимостей)

- **KISS** (Keep It Simple, Stupid) - простота предпочтительнее сложности

- **DRY** (Don't Repeat Yourself) - избегание дублирования кода

### Последовательность работы

```
1. 📋 Анализ требований
2. 🏗️ Проектирование архитектуры
3. 🤝 Согласование с заказчиком
4. ⚙️ Реализация
5. ✅ Валидация и документирование
```

**Важно**: Кодирование начинается ТОЛЬКО после согласования архитектурного решения.

---

## 🌟 Методология работы

Проект использует **4-этапную методологию экспертного процессного моделирования**:

### Этап 1: Анализ и структурирование 📊
- Идентификация типа процесса
- Определение границ и ключевых разделов
- Предложение структуры работы
- **Избегание перегрузки контекста** - разбиение на части по 5-10 элементов

### Этап 2: RACI матрица 👥
- Построение матрицы ответственности для каждого раздела
- Определение ролевой модели и должностей
- Согласование структуры Pool и Lanes
- **Результат**: файл `[Процесс]_RACI.md`

### Этап 3: Текстовый пайплайн 📝
Детальное описание каждого activity по 7 пунктам:
1. Название и тип выполнения (автоматизация)
2. Ответственный
3. **Способы передачи данных**
4. **Время исполнения**
5. **Метрики оценки исполнения**
6. Условия и правила
7. Риски и исключения

**Результат**: файл `[Процесс]_Pipeline.md`

### Этап 4: BPMN и документация 🎨
- Генерация BPMN XML с полной визуализацией
- Создание MD документации с таблицами
- Валидация в Camunda Modeler
- **Результат**: файлы `[Процесс].bpmn` + `[Процесс].md`

---

## 🔧 Технологический стек

### Обработка документов
- **PDF**: Извлечение текста, OCR при необходимости
- **DOCX**: Парсинг структуры документа, таблиц, списков
- **XLSX**: Анализ табличных данных, связей
- **TXT**: Прямое чтение текста

### Генерация BPMN
- **BPMN 2.0**: Стандарт моделирования бизнес-процессов
- **XML**: Структурированное представление
- **BPMNDi**: Визуальная информация (координаты, размеры)

## 📊 Элементы BPMN 2.0

**Система поддерживает полный набор элементов BPMN 2.0 согласно спецификации OMG**

### Основные элементы (используются часто)

#### 🎯 Активности (Activities)
- ▢ **Abstract Task** - Абстрактная задача
- 👤 **User Task** - Задача пользователя (человек + UI)
- ✋ **Manual Task** - Ручное выполнение (без IT-систем)
- ⚙️ **Service Task** - Автоматизированная задача
- 📦 **Subprocess** - Подпроцесс (группировка задач)
- 🔗 **Call Activity** - Ссылка на типовой процесс

#### ⚡ События (Events)
**Стартовые:**
- ⚪ **None Start** - Обычное начало
- 📨 **Message Start** - Начало по сообщению
- ⏰ **Timer Start** - Начало по времени

**Промежуточные:**
- 📨 **Message Catch/Throw** - Получение/отправка сообщения
- ⏰ **Timer Catch** - Ожидание времени
- ⚠️ **Escalation Throw** - Эскалация проблемы

**Конечные:**
- ⚫ **None End** - Обычное завершение
- 📨 **Message End** - Завершение с сообщением
- ❌ **Error End** - Завершение с ошибкой
- 🛑 **Terminate End** - Принудительная остановка

#### 🔀 Шлюзы (Gateways)
- ◇ **Exclusive (XOR)** - Исключающее ИЛИ (только одна ветвь)
- ◇ **Parallel (AND)** - Параллельный (все ветви одновременно)
- ◇ **Inclusive (OR)** - Неэксклюзивный (выполненные условия)
- ◇ **Event-Based** - На основе событий (первое произошедшее)

#### 🏊 Организация (Swimlanes)
- **Pool** - Пул (организация/участник процесса)
- **Lane** - Дорожка (роль/подразделение)

#### → Потоки (Flows)
- **Sequence Flow** - Последовательный поток (внутри процесса)
- **Message Flow** - Поток сообщений (между участниками)

### Расширенные элементы (по необходимости)

**Дополнительные задачи:**
- Script Task, Business Rule Task, Send Task, Receive Task

**Специальные подпроцессы:**
- Event Subprocess, Transaction, Ad-Hoc Subprocess

**Циклы:**
- Standard Loop, Multi-Instance Parallel, Multi-Instance Sequential

**Дополнительные события:**
- Signal, Conditional, Compensation, Cancel

**Артефакты:**
- Data Object, Data Store, Text Annotation, Group

---

### 📚 Полная документация

**Детальное описание ВСЕХ элементов BPMN 2.0:**  
→ [docs/BPMN_Elements_Reference.md](docs/BPMN_Elements_Reference.md)

**Содержит:**
- Полный перечень элементов с XML тегами
- Описание назначения и семантики
- Правила использования из КД-СТ-161-01
- Рекомендации OMG BPMN 2.0.2
- Примеры применения
- Приоритеты использования

**Источники:**
- OMG BPMN 2.0.2 Specification
- КД-СТ-161-01 "Требования к моделированию в Business Studio"
- Camunda BPMN 2.0 Implementation Reference

---

### ⚠️ Использование расширенных элементов

При необходимости использования элементов, не описанных в основном списке:

1. **Разрешено** использовать любые элементы BPMN 2.0
2. **Обязательно** указать в отчете и документации:
   - Название элемента
   - XML тег
   - Обоснование необходимости
   - Ссылка на справочник
3. **Документировать** в MD файле процесса с примерами

Подробнее см. раздел "Документирование новых элементов" в `.cursorrules`

---

### 📋 Рекомендации по количеству элементов

**Согласно КД-СТ-161-01:**
- **Дорожки (Lanes):** 1-5 (оптимально), максимум 7
- **Задачи (Tasks):** 3-15 (оптимально), максимум 20
- **Формат:** А4 альбомная ориентация
- **Направление:** Слева направо по времени

## 🎨 Пример использования

### Входной документ (PDF/DOCX)
```
Руководство по договорной работе
1. Инициирование договора
2. Проверка бюджета
3. Подготовка проекта
...
```

### Выходные файлы (4 связанных файла)

#### 1. RACI матрица (`_RACI.md`)
```markdown
| Activity | РПФМ | ОСД | ПУ | БС |
|----------|------|-----|----|----|
| Инициирование | A | R | I | I |
| Проверка бюджета | A | R | C | I |
| Подготовка проекта | C | R | I | C |
```

#### 2. Текстовый пайплайн (`_Pipeline.md`)
```
ACTIVITY: Подготовка проекта
1️⃣ Способ: 👤 Ручная операция (20% автоматизации)
2️⃣ Ответственный: ОСД (Lane: Ответственный сотрудник)
3️⃣ Способы передачи: ИС «Договоры», Email
4️⃣ Время: 5 рабочих дней
5️⃣ Метрики: % соблюдения срока, качество проекта
...
```

#### 3. BPMN диаграмма (`.bpmn`)
- Визуальная схема процесса в Camunda Modeler
- Все элементы с правильными координатами
- Связи между элементами
- Pool с 6 lanes по ролям

#### 4. MD документация (`.md`)
```markdown
## Таблица 3. Задачи в дорожке "ОСД"

| Название | Ответственный | Срок | Описание |
|----------|---------------|------|----------|
| Подготовка проекта | ОСД | 5 дней | Детали... |
```

## ✅ Проверенные кейсы

- ✅ Жизненный цикл договора (18 элементов, 6 дорожек)
- ✅ Сложные условные переходы (gateways)
- ✅ Циклические процессы
- ✅ Многоуровневая организация (pools/lanes)

## 🔍 Качество

### BPMN валидация
- ✅ Корректная структура XML
- ✅ Все обязательные атрибуты
- ✅ Визуальные координаты для всех элементов
- ✅ Правильные связи между элементами

### Документация
- ✅ Структурированные таблицы
- ✅ Привязка по названиям элементов
- ✅ Полнота информации
- ✅ Читаемость и навигация

## 📝 История изменений

Все значимые изменения проекта документируются в файле [`Changelog.md`](Changelog.md).

### Формат записи
```markdown
## [DD-MM-YYYY] - Краткое описание изменений

### Добавлено
- Новые функции и возможности

### Изменено
- Модификации существующего функционала

### Исправлено
- Исправленные ошибки и баги
```

Ведение Changelog является обязательной частью разработки и обновляется при каждом значимом изменении проекта.

---

## 📚 Источники

Проект основан на стандартах:
- BPMN 2.0 Specification
- Camunda Modeler Documentation
- OMG (Object Management Group) Standards

## 🚧 Развитие проекта

### В разработке
- [ ] Автоматическое распознавание типов элементов процесса
- [ ] Поддержка подпроцессов (Sub-processes)
- [ ] Экспорт в другие форматы (SVG, PNG)
- [ ] Валидация бизнес-логики процесса

### Планируется
- [ ] Веб-интерфейс для загрузки документов
- [ ] Batch-обработка множества документов
- [ ] Сравнение версий процессов
- [ ] Генерация отчетов по процессам

## 📞 Контакты

Проект: **Obligations - BPMN Process Automation**  
Организация: **ПАО «Авиакомпания «ЮТэйр»**

---

*Последнее обновление: 05.11.2025*
